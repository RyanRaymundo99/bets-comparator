generator client {
  provider = "prisma-client-js"
  output   = "./generated/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ========================================
// AUTHENTICATION MODELS
// ========================================

model User {
  id            String       @id @map("_id")
  name          String
  email         String       @unique
  password      String?
  emailVerified Boolean      @default(false)
  role          UserRole     @default(CLIENT)
  image         String?
  createdAt     DateTime
  updatedAt     DateTime
  accounts      Account[]
  sessions      Session[]
  comparisons   Comparison[]

  @@map("user")
}

model Session {
  id        String   @id @map("_id")
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Account {
  id                    String    @id @map("_id")
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("account")
}

model Verification {
  id          String           @id @map("_id")
  identifier  String // email
  value       String // verification code
  type        VerificationType // EMAIL or PASSWORD_RESET
  purpose     String? // Additional context like "signup", "password_reset"
  attempts    Int              @default(0)
  maxAttempts Int              @default(3)
  expiresAt   DateTime
  createdAt   DateTime?        @default(now())
  updatedAt   DateTime?        @updatedAt

  @@map("verification")
}

enum VerificationType {
  EMAIL
  PASSWORD_RESET
}

enum UserRole {
  ADMIN
  CLIENT
}

// ========================================
// BETS COMPARATOR MODELS
// ========================================

model Bet {
  id           String      @id @default(cuid())
  name         String
  company      String? // Company name (e.g., "PIXBET SOLUÇÕES TECNOLÓGICAS LTDA")
  domain       String?     @unique // Main domain (e.g., "pix.bet.br")
  cnpj         String? // CNPJ if available
  url          String? // Website URL (kept for compatibility)
  region       String? // Region/scope (kept for compatibility)
  license      String? // License info (kept for compatibility)
  status       String?     @default("Funcionando") // Funcionando, Fora do ar, etc
  scope        String? // Brasil or Mundial
  platformType String? // Casino, Sports, Ambos
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  parameters   Parameter[]

  @@map("bet")
}

model Parameter {
  id       String  @id @default(cuid())
  betId    String
  name     String
  category String? // Category from parameter definitions

  // Different value types to support all parameter types
  valueText    String? // For text values
  valueNumber  Decimal? @db.Decimal(20, 2) // For numeric values
  valueBoolean Boolean? // For yes/no values
  valueRating  Int? // For star ratings (0-5)

  unit        String? // e.g., "R$", "%", "score"
  description String?  @db.Text // Longer descriptions
  type        String? // "text", "number", "currency", "boolean", "rating", "percentage", "select"
  options     String[] // For select type parameters

  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  bet       Bet                @relation(fields: [betId], references: [id], onDelete: Cascade)
  history   ParameterHistory[]

  @@unique([betId, name])
  @@map("parameter")
}

model ParameterHistory {
  id          String @id @default(cuid())
  parameterId String

  // Store all value types for history
  valueText    String?
  valueNumber  Decimal? @db.Decimal(20, 2)
  valueBoolean Boolean?
  valueRating  Int?

  notes     String?   @db.Text // Optional notes about why the value changed
  createdAt DateTime  @default(now())
  parameter Parameter @relation(fields: [parameterId], references: [id], onDelete: Cascade)

  @@map("parameter_history")
}

model Comparison {
  id           String   @id @default(cuid())
  userId       String
  name         String? // Optional name for saved comparisons
  selectedBets String[] // Array of bet IDs
  filters      Json? // Store filter settings
  insights     String? // AI-generated insights
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("comparison")
}
